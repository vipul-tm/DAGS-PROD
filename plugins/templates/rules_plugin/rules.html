{% extends "airflow/master.html" %}

{% block title %}{{ title }}{% endblock %}



{% block body %}
{{ super() }}
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='dataTables/datatables.min.css') }}">

    <div class="row" style="width:2059px">
                   
            <h1 class="text-center login-title">RULES</h1>
            <table class="table table-striped table-bordered"  id="ruletable">

                <thead></thead>
                <tbody></tbody>
            </table>        
    </div>

{% endblock %}

{% block tail_js %}
    {{ super() }}
    <script type="text/javascript" charset="utf8" src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.8.2.min.js"></script>
    <script type="text/javascript" charset="utf8" src="{{ url_for('static',  filename='dataTables/datatables.min.js') }}"> </script>
      
    <script>
        // Initialize DataTable
           $('.dropdown').click(function(){
      $(this).addClass('open');
      });
           
        $(document).ready(function(){
            var loc = window.location.pathname;
            console.log(loc)
            page = loc.split("/")[2]
            console.log(page)
            if (page == "testview")
            {
                rule_table = $("#ruletable").dataTable({
                    "aoColumns": [
                        { "mData": "device_type", 'sTitle': 'Device Type', 'sWidth': 'auto', 'bSortable': true },
                        { "mData": "severity", 'sTitle': 'Severity', 'sWidth': 'auto', 'bSortable': true },
                        { "mData": "operator", 'sTitle': 'Operator', 'sWidth': 'auto', 'bSortable': true},
                        { "mData": "name", 'sTitle': 'Name', 'sWidth': 'auto', 'bSortable': true},
                        { "mData": "value", 'sTitle': 'Value', 'sWidth': 'auto', 'bSortable': true},
                   ],
                   "sScrollY": "500px",
                   "bPaginate": true,
                    "pageLength": 100,
                    "dom": 'Bfrtip',
                    "buttons": [ 'excel']

                   // "bScrollCollapse": true
                });
            }
            else if (page == "networkview"){
                rule_table = $("#ruletable").dataTable({
                    "aoColumns": [
                        { "mData": "check_time", 'sTitle': 'check_time', 'sWidth': 'auto', 'bSortable': true },
                        { "mData": "severity", 'sTitle': 'severity', 'sWidth': 'auto', 'bSortable': true },
                        { "mData": "service", 'sTitle': 'service', 'sWidth': 'auto', 'bSortable': true},
                        { "mData": "avg_value", 'sTitle': 'avg_value', 'sWidth': 'auto', 'bSortable': true},
                        { "mData": "max_value", 'sTitle': 'max_value', 'sWidth': 'auto', 'bSortable': true},
                        { "mData": "min_value", 'sTitle': 'min_value', 'sWidth': 'auto', 'bSortable': true},
                        { "mData": "age", 'sTitle': 'age', 'sWidth': 'auto', 'bSortable': true},
                        { "mData": "local_timestamp", 'sTitle': 'local_timestamp', 'sWidth': 'auto', 'bSortable': true},
                        { "mData": "site", 'sTitle': 'site', 'sWidth': 'auto', 'bSortable': true},
                        { "mData": "war", 'sTitle': 'war', 'sWidth': 'auto', 'bSortable': true},
                        { "mData": "host", 'sTitle': 'host', 'sWidth': 'auto', 'bSortable': true},
                        { "mData": "machine_name", 'sTitle': 'machine_name', 'sWidth': 'auto', 'bSortable': true},
                        { "mData": "refer", 'sTitle': 'refer', 'sWidth': 'auto', 'bSortable': true},
                        { "mData": "cric", 'sTitle': 'cric', 'sWidth': 'auto', 'bSortable': true},
                        { "mData": "ip_address", 'sTitle': 'ip_address', 'sWidth': 'auto', 'bSortable': true},
                        { "mData": "ds", 'sTitle': 'ds', 'sWidth': 'auto', 'bSortable': true},
                        { "mData": "cur", 'sTitle': 'cur', 'sWidth': 'auto', 'bSortable': true},
                        
                   ],
                   "sScrollY": "500px",
                   "bPaginate": true,
                    "pageLength": 100,
                    "dom": 'Bfrtip',
                    "buttons": [ 'excel']

                   // "bScrollCollapse": true
                });

            }
            else if (page == "serviceview"){
                rule_table = $("#ruletable").dataTable({
                    "aoColumns": [
                         { "mData": "check_time", 'sTitle': 'check_time', 'sWidth': 'auto', 'bSortable': true },
                        { "mData": "severity", 'sTitle': 'severity', 'sWidth': 'auto', 'bSortable': true },
                        { "mData": "service", 'sTitle': 'service', 'sWidth': 'auto', 'bSortable': true},
                        { "mData": "age", 'sTitle': 'age', 'sWidth': 'auto', 'bSortable': true},
                        { "mData": "local_timestamp", 'sTitle': 'local_timestamp', 'sWidth': 'auto', 'bSortable': true},
                        { "mData": "site", 'sTitle': 'site', 'sWidth': 'auto', 'bSortable': true},
                        { "mData": "war", 'sTitle': 'war', 'sWidth': 'auto', 'bSortable': true},
                        { "mData": "host", 'sTitle': 'host', 'sWidth': 'auto', 'bSortable': true},
                        { "mData": "machine_name", 'sTitle': 'machine_name', 'sWidth': 'auto', 'bSortable': true},
                        { "mData": "refer", 'sTitle': 'refer', 'sWidth': 'auto', 'bSortable': true},
                        { "mData": "cric", 'sTitle': 'cric', 'sWidth': 'auto', 'bSortable': true},
                        { "mData": "ip_address", 'sTitle': 'ip_address', 'sWidth': 'auto', 'bSortable': true},
                        { "mData": "ds", 'sTitle': 'ds', 'sWidth': 'auto', 'bSortable': true},
                        { "mData": "cur", 'sTitle': 'cur', 'sWidth': 'auto', 'bSortable': true},
                   ],
                   "sScrollY": "500px",
                   "bPaginate": true,
                    "pageLength": 100,
                    "dom": 'Bfrtip',
                    "buttons": [ 'excel']

                   // "bScrollCollapse": true
                });
                
            }
            else if (page == "rediskeyview"){
                rule_table = $("#ruletable").dataTable({
                    "aoColumns": [
                        { "mData": "check_timestamp", 'sTitle': 'check_timestamp', 'sWidth': 'auto', 'bSortable': true},
                        { "mData": "severity", 'sTitle': 'severity', 'sWidth': 'auto', 'bSortable': true },
                        { "mData": "service_name", 'sTitle': 'service', 'sWidth': 'auto', 'bSortable': true},
                        { "mData": "age", 'sTitle': 'age', 'sWidth': 'auto', 'bSortable': true},
                        { "mData": "sys_timestamp", 'sTitle': 'local_timestamp', 'sWidth': 'auto', 'bSortable': true},
                        { "mData": "site_name", 'sTitle': 'site', 'sWidth': 'auto', 'bSortable': true},
                        { "mData": "warning_threshold", 'sTitle': 'war', 'sWidth': 'auto', 'bSortable': true},
                        { "mData": "device_name", 'sTitle': 'host', 'sWidth': 'auto', 'bSortable': true},
                        { "mData": "machine_name", 'sTitle': 'machine_name', 'sWidth': 'auto', 'bSortable': true},
                        { "mData": "refer", 'sTitle': 'refer', 'sWidth': 'auto', 'bSortable': true},
                        { "mData": "critical_threshold", 'sTitle': 'cric', 'sWidth': 'auto', 'bSortable': true},
                        { "mData": "ip_address", 'sTitle': 'ip_address', 'sWidth': 'auto', 'bSortable': true},
                        { "mData": "data_source", 'sTitle': 'ds', 'sWidth': 'auto', 'bSortable': true},
                        { "mData": "current_value", 'sTitle': 'cur', 'sWidth': 'auto', 'bSortable': true},
                        { "mData": "avg_value", 'sTitle': 'avg_value', 'sWidth': 'auto', 'bSortable': true},
                        
                   ],
                   "sScrollY": "500px",
                   "bPaginate": true,
                    "pageLength": 100,
                    "dom": 'Bfrtip',
                    "buttons": [ 'excel']

                   // "bScrollCollapse": true
                });
                
            }
            var data_list = [];
            if (page == "testview"){
                var a = {{ data|tojson|safe }};
                //console.log(a.length)
                
                var device_dict={
                    'device_type':'unknown',
                    "severity":'unknown',
                    "operator":'unknown',
                    "name":'unknown',
                    "value":'unknown',

                };
                data = JSON.parse(a);
                for (var x in data)
                {
                    var device_dict={
                    'device_type':'unknown',
                    "severity":'unknown',
                    "operator":'unknown',
                    "name":'unknown',
                    "value":'unknown',
                };
                    device_dict['device_type'] = x;
                        for (var sev in data[x]){

                         device_dict['severity'] = data[x][sev][0]
                         device_dict['operator']= data[x][sev][1]['operator']
                         device_dict['name']= data[x][sev][1]['name']
                         device_dict['value']   = data[x][sev][1]['value']
                         var copiedObject = jQuery.extend(true, {}, device_dict)
                         data_list.push(copiedObject)
                        }
                        
                    
                }
                $(".login-title").html("Rules")
           }
           else if (page == "networkview" || page == "serviceview"){
            data_list = {{ data|tojson|safe }};
           $(".login-title").html(page)
           }
           else if (page == "rediskeyview"){
            console.log("Loading Page")         
            data_list = {{ data|tojson|safe }};
            console.log(data_list.length)
           $(".login-title").html("KPI Data")
           }
            rule_table.fnAddData(data_list)
        })
    </script>

{% endblock %}

